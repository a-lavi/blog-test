{"ast":null,"code":"var _jsxFileName = \"/Users/alirahmani/Project/blog_project/src/Components/SessionTimeout.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport moment from 'moment';\nimport { IdleTimeOutModal } from './LogoutModal';\nimport useAuth from \"../hooks/useAuth\";\nimport useLogout from '../hooks/useLogout';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SessionTimeout = props => {\n  _s();\n\n  const [showModal, setShowModal] = useState(false);\n  const {\n    auth\n  } = useAuth;\n  const logout = useLogout();\n  let timer = undefined;\n  const events = ['click', 'load', 'keydown'];\n\n  const eventHandler = eventType => {\n    console.log(eventType);\n\n    if (auth.isAuthenticated) {\n      localStorage.setItem('lastInteractionTime', moment());\n\n      if (timer) {\n        startTimer();\n      }\n    }\n  };\n\n  useEffect(() => {\n    addEvents();\n    return () => {\n      removeEvents();\n      clearTimeout(timer);\n    };\n  }, []);\n\n  const startTimer = () => {\n    if (timer) {\n      clearTimeout(timer);\n    }\n\n    timer = setTimeout(() => {\n      let lastInteractionTime = localStorage.getItem('lastInteractionTime');\n      console.log(lastInteractionTime);\n      const diff = moment.duration(moment().diff(moment(lastInteractionTime)));\n      let timeOutInterval = props.timeOutInterval ? props.timeOutInterval : 6000;\n\n      if (!auth.isAuthenticated) {\n        clearTimeout(timer);\n      } else {\n        if (diff._milliseconds < timeOutInterval) {\n          startTimer();\n          props.onActive();\n        } else {\n          props.onIdle();\n          setShowModal(true);\n        }\n      }\n    }, props.timeOutInterval ? props.timeOutInterval : 6000);\n  };\n\n  const addEvents = () => {\n    events.forEach(eventName => {\n      window.addEventListener(eventName, eventHandler);\n    });\n    startTimer();\n  };\n\n  const removeEvents = () => {\n    events.forEach(eventName => {\n      window.removeEventListener(eventName, eventHandler);\n    });\n  };\n\n  const handleContinueSession = () => {\n    setShowModal(false);\n    logout();\n  };\n\n  const handleLogout = () => {\n    removeEvents();\n    clearTimeout(timer);\n    logout();\n    props.onLogout();\n    setShowModal(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(IdleTimeOutModal, {\n      showModal: showModal,\n      handleContinue: handleContinueSession,\n      handleLogout: handleLogout\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 9\n  }, this);\n};\n\n_s(SessionTimeout, \"INqeq7Gmm0cwfqoF+kp0fBYysjo=\", false, function () {\n  return [useLogout];\n});\n\n_c = SessionTimeout;\nexport default SessionTimeout;\n\nvar _c;\n\n$RefreshReg$(_c, \"SessionTimeout\");","map":{"version":3,"names":["React","useEffect","useState","moment","IdleTimeOutModal","useAuth","useLogout","SessionTimeout","props","showModal","setShowModal","auth","logout","timer","undefined","events","eventHandler","eventType","console","log","isAuthenticated","localStorage","setItem","startTimer","addEvents","removeEvents","clearTimeout","setTimeout","lastInteractionTime","getItem","diff","duration","timeOutInterval","_milliseconds","onActive","onIdle","forEach","eventName","window","addEventListener","removeEventListener","handleContinueSession","handleLogout","onLogout"],"sources":["/Users/alirahmani/Project/blog_project/src/Components/SessionTimeout.js"],"sourcesContent":["import React, { useEffect, useState} from 'react';\nimport moment from 'moment'\nimport { IdleTimeOutModal } from './LogoutModal'\nimport useAuth from \"../hooks/useAuth\";\nimport useLogout from '../hooks/useLogout';\nconst SessionTimeout = (props)=>{\n    const[showModal,setShowModal]=useState(false)\n    const {auth} = useAuth\n    const logout = useLogout();\n    let timer=undefined;\n    const events= ['click','load','keydown']\n    const eventHandler =(eventType)=>{\n        \n        console.log(eventType)\n        if(auth.isAuthenticated){\n            localStorage.setItem('lastInteractionTime',moment() )\n            \n            if(timer){\n              \n              startTimer();\n          }\n            \n        }\n        \n    };\n    \n    useEffect(()=>{\n        addEvents();\n        \n        return (()=>{\n            \n            removeEvents();\n            clearTimeout(timer);\n        })\n    },[])\n    \n    const startTimer=()=>{\n        \n        if(timer){\n            clearTimeout(timer)\n        }\n        timer=setTimeout(()=>{\n            \n            let lastInteractionTime=localStorage.getItem('lastInteractionTime')\n            console.log(lastInteractionTime)\n            const diff = moment.duration(moment().diff(moment(lastInteractionTime)));\n            let timeOutInterval=props.timeOutInterval?props.timeOutInterval:6000;\n            if(!auth.isAuthenticated){\n                clearTimeout(timer)\n            }else{\n                if(diff._milliseconds<timeOutInterval){\n                    startTimer();\n                    props.onActive();\n                }else{\n                    props.onIdle();\n                    setShowModal(true)\n                }\n            }\n            \n        },props.timeOutInterval?props.timeOutInterval:6000)\n        \n        \n        \n        \n        \n    }\n    const addEvents=()=>{\n        \n        events.forEach(eventName=>{\n            window.addEventListener(eventName,eventHandler)\n        })\n        \n        startTimer();\n    }\n    \n    const removeEvents=()=>{\n        events.forEach(eventName=>{\n            window.removeEventListener(eventName,eventHandler)\n        })\n    };\n    \n    const handleContinueSession = ()=>{\n        setShowModal(false)\n        logout()\n    }\n    const handleLogout = ()=>{\n        removeEvents();\n        clearTimeout(timer);\n        logout()\n        props.onLogout();\n        setShowModal(false)\n        \n    }\n    \n    return(\n        <div>\n        \n        <IdleTimeOutModal \n        showModal={showModal} \n        handleContinue={handleContinueSession}\n        handleLogout={handleLogout}\n        />\n        \n        </div>\n        )\n        \n    }\n  \n  export default SessionTimeout;"],"mappings":"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"},"metadata":{},"sourceType":"module"}