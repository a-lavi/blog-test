{"ast":null,"code":"var _jsxFileName = \"/Users/alirahmani/Project/blog_project/src/Components/SessionTimeout.js\",\n    _s = $RefreshSig$();\n\nimport useLogout from \"../hooks/useAuth\";\nimport React, { useState, useEffect, useCallback, useRef, Fragment } from 'react';\nimport moment from 'moment';\nimport useAuth from '../hooks/useAuth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SessionTimeout = () => {\n  _s();\n\n  const [events, setEvents] = useState(['click', 'load', 'scroll']);\n  const [second, setSecond] = useState(0);\n  const [isOpen, setOpen] = useState(false);\n  const {\n    auth\n  } = useAuth();\n  console.log(auth);\n  const logout = useLogout();\n  let timeStamp;\n  let warningInactiveInterval = useRef();\n  let startTimerInterval = useRef(); // start inactive check\n\n  let timeChecker = () => {\n    startTimerInterval.current = setTimeout(() => {\n      let storedTimeStamp = sessionStorage.getItem('lastTimeStamp');\n      warningInactive(storedTimeStamp);\n    }, 60000);\n  }; // warning timer\n\n\n  let warningInactive = timeString => {\n    clearTimeout(startTimerInterval.current);\n    warningInactiveInterval.current = setInterval(() => {\n      const maxTime = 2;\n      const popTime = 1;\n      const diff = moment.duration(moment().diff(moment(timeString)));\n      const minPast = diff.minutes();\n      const leftSecond = 60 - diff.seconds();\n\n      if (minPast === popTime) {\n        setSecond(leftSecond);\n        setOpen(true);\n      }\n\n      if (minPast === maxTime) {\n        clearInterval(warningInactiveInterval.current);\n        setOpen(false);\n        sessionStorage.removeItem('lastTimeStamp');\n        logout();\n      }\n    }, 1000);\n  }; // reset interval timer\n\n\n  let resetTimer = useCallback(() => {\n    clearTimeout(startTimerInterval.current);\n    clearInterval(warningInactiveInterval.current);\n\n    if (isAuthenticated) {\n      timeStamp = moment();\n      sessionStorage.setItem('lastTimeStamp', timeStamp);\n    } else {\n      clearInterval(warningInactiveInterval.current);\n      sessionStorage.removeItem('lastTimeStamp');\n    }\n\n    timeChecker();\n    setOpen(false);\n  }, [isAuthenticated]); // handle close popup\n\n  const handleClose = () => {\n    setOpen(false);\n    resetTimer();\n  };\n\n  useEffect(() => {\n    events.forEach(event => {\n      window.addEventListener(event, resetTimer);\n    });\n    timeChecker();\n    return () => {\n      clearTimeout(startTimerInterval.current); //   resetTimer();\n    };\n  }, [resetTimer, events, timeChecker]);\n  console.log(second);\n\n  if (!isOpen) {\n    return null;\n  } // change fragment to modal and handleclose func to close\n\n\n  return /*#__PURE__*/_jsxDEV(Fragment, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 105,\n    columnNumber: 12\n  }, this);\n};\n\n_s(SessionTimeout, \"hqUfa+HBrVubHQsLaLtAG3Hn9Ns=\", false, function () {\n  return [useAuth, useLogout];\n});\n\n_c = SessionTimeout;\nexport default SessionTimeout;\n\nvar _c;\n\n$RefreshReg$(_c, \"SessionTimeout\");","map":{"version":3,"names":["useLogout","React","useState","useEffect","useCallback","useRef","Fragment","moment","useAuth","SessionTimeout","events","setEvents","second","setSecond","isOpen","setOpen","auth","console","log","logout","timeStamp","warningInactiveInterval","startTimerInterval","timeChecker","current","setTimeout","storedTimeStamp","sessionStorage","getItem","warningInactive","timeString","clearTimeout","setInterval","maxTime","popTime","diff","duration","minPast","minutes","leftSecond","seconds","clearInterval","removeItem","resetTimer","isAuthenticated","setItem","handleClose","forEach","event","window","addEventListener"],"sources":["/Users/alirahmani/Project/blog_project/src/Components/SessionTimeout.js"],"sourcesContent":["import useLogout from \"../hooks/useAuth\";\n\nimport React, {\n    useState,\n    useEffect,\n    useCallback,\n    useRef,\n    Fragment,\n  } from 'react';\n  import moment from 'moment';\n  import useAuth from '../hooks/useAuth';\n  \n  const SessionTimeout = () => {\n    const [events, setEvents] = useState(['click', 'load', 'scroll']);\n    const [second, setSecond] = useState(0);\n    const [isOpen, setOpen] = useState(false);\n    const {\n       auth\n      \n    } = useAuth();\n    console.log(auth)\n    const logout = useLogout();\n  \n    let timeStamp;\n    let warningInactiveInterval = useRef();\n    let startTimerInterval = useRef();\n  \n    // start inactive check\n    let timeChecker = () => {\n      startTimerInterval.current = setTimeout(() => {\n        let storedTimeStamp = sessionStorage.getItem('lastTimeStamp');\n        warningInactive(storedTimeStamp);\n      }, 60000);\n    };\n  \n    // warning timer\n    let warningInactive = (timeString) => {\n      clearTimeout(startTimerInterval.current);\n  \n      warningInactiveInterval.current = setInterval(() => {\n        const maxTime = 2;\n        const popTime = 1;\n  \n        const diff = moment.duration(moment().diff(moment(timeString)));\n        const minPast = diff.minutes();\n        const leftSecond = 60 - diff.seconds();\n  \n        if (minPast === popTime) {\n          setSecond(leftSecond);\n          setOpen(true);\n        }\n  \n        if (minPast === maxTime) {\n          clearInterval(warningInactiveInterval.current);\n          setOpen(false);\n          sessionStorage.removeItem('lastTimeStamp');\n          logout();\n        }\n      }, 1000);\n    };\n  \n    // reset interval timer\n    let resetTimer = useCallback(() => {\n      clearTimeout(startTimerInterval.current);\n      clearInterval(warningInactiveInterval.current);\n  \n      if (isAuthenticated) {\n        timeStamp = moment();\n        sessionStorage.setItem('lastTimeStamp', timeStamp);\n      } else {\n        clearInterval(warningInactiveInterval.current);\n        sessionStorage.removeItem('lastTimeStamp');\n      }\n      timeChecker();\n      setOpen(false);\n    }, [isAuthenticated]);\n  \n    // handle close popup\n    const handleClose = () => {\n      setOpen(false);\n  \n      resetTimer();\n    };\n  \n    useEffect(() => {\n      events.forEach((event) => {\n        window.addEventListener(event, resetTimer);\n      });\n  \n      timeChecker();\n  \n      return () => {\n        clearTimeout(startTimerInterval.current);\n        //   resetTimer();\n      };\n    }, [resetTimer, events, timeChecker]);\n  \n    console.log(second);\n  \n    if (!isOpen) {\n      return null;\n    }\n  \n    // change fragment to modal and handleclose func to close\n    return <Fragment />;\n  };\n  \n  export default SessionTimeout;"],"mappings":"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"},"metadata":{},"sourceType":"module"}