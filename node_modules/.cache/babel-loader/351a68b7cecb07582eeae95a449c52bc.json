{"ast":null,"code":"var _jsxFileName = \"/Users/alirahmani/Project/blog_project/src/Components/SessionTimeout.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useCallback, useRef, Fragment } from 'react';\nimport moment from 'moment';\nimport useAuth from '../hooks/useAuth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SessionTimeout = () => {\n  _s();\n\n  const [events, setEvents] = useState(['click', 'load', 'scroll']);\n  const [second, setSecond] = useState(0);\n  const [isOpen, setOpen] = useState(false);\n  const {\n    isAuthenticated\n  } = useAuth();\n  let timeStamp;\n  let warningInactiveInterval = useRef();\n  let startTimerInterval = useRef(); // start inactive check\n\n  let timeChecker = () => {\n    startTimerInterval.current = setTimeout(() => {\n      let storedTimeStamp = sessionStorage.getItem('lastTimeStamp');\n      warningInactive(storedTimeStamp);\n    }, 60000);\n  }; // warning timer\n\n\n  let warningInactive = timeString => {\n    clearTimeout(startTimerInterval.current);\n    warningInactiveInterval.current = setInterval(() => {\n      const maxTime = 2;\n      const popTime = 1;\n      const diff = moment.duration(moment().diff(moment(timeString)));\n      const minPast = diff.minutes();\n      const leftSecond = 60 - diff.seconds();\n\n      if (minPast === popTime) {\n        setSecond(leftSecond);\n        setOpen(true);\n      }\n\n      if (minPast === maxTime) {\n        clearInterval(warningInactiveInterval.current);\n        setOpen(false);\n        sessionStorage.removeItem('lastTimeStamp');\n        logout();\n      }\n    }, 1000);\n  }; // reset interval timer\n\n\n  let resetTimer = useCallback(() => {\n    clearTimeout(startTimerInterval.current);\n    clearInterval(warningInactiveInterval.current);\n\n    if (isAuthenticated) {\n      timeStamp = moment();\n      sessionStorage.setItem('lastTimeStamp', timeStamp);\n    } else {\n      clearInterval(warningInactiveInterval.current);\n      sessionStorage.removeItem('lastTimeStamp');\n    }\n\n    timeChecker();\n    setOpen(false);\n  }, [isAuthenticated]); // handle close popup\n\n  const handleClose = () => {\n    setOpen(false);\n    resetTimer();\n  };\n\n  useEffect(() => {\n    events.forEach(event => {\n      window.addEventListener(event, resetTimer);\n    });\n    timeChecker();\n    return () => {\n      clearTimeout(startTimerInterval.current); //   resetTimer();\n    };\n  }, [resetTimer, events, timeChecker]);\n  console.log(second);\n\n  if (!isOpen) {\n    return null;\n  } // change fragment to modal and handleclose func to close\n\n\n  return /*#__PURE__*/_jsxDEV(Fragment, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 12\n  }, this);\n};\n\n_s(SessionTimeout, \"wu6kmCPzFb1kz4fIudDKvbgHmu4=\", false, function () {\n  return [useAuth];\n});\n\n_c = SessionTimeout;\nexport default SessionTimeout;\n\nvar _c;\n\n$RefreshReg$(_c, \"SessionTimeout\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","Fragment","moment","useAuth","SessionTimeout","events","setEvents","second","setSecond","isOpen","setOpen","isAuthenticated","timeStamp","warningInactiveInterval","startTimerInterval","timeChecker","current","setTimeout","storedTimeStamp","sessionStorage","getItem","warningInactive","timeString","clearTimeout","setInterval","maxTime","popTime","diff","duration","minPast","minutes","leftSecond","seconds","clearInterval","removeItem","logout","resetTimer","setItem","handleClose","forEach","event","window","addEventListener","console","log"],"sources":["/Users/alirahmani/Project/blog_project/src/Components/SessionTimeout.js"],"sourcesContent":["\n\nimport React, {\n    useState,\n    useEffect,\n    useCallback,\n    useRef,\n    Fragment,\n  } from 'react';\n  import moment from 'moment';\n  import useAuth from '../hooks/useAuth';\n  \n  const SessionTimeout = () => {\n    const [events, setEvents] = useState(['click', 'load', 'scroll']);\n    const [second, setSecond] = useState(0);\n    const [isOpen, setOpen] = useState(false);\n    const {\n       isAuthenticated ,\n      \n    } = useAuth();\n  \n    let timeStamp;\n    let warningInactiveInterval = useRef();\n    let startTimerInterval = useRef();\n  \n    // start inactive check\n    let timeChecker = () => {\n      startTimerInterval.current = setTimeout(() => {\n        let storedTimeStamp = sessionStorage.getItem('lastTimeStamp');\n        warningInactive(storedTimeStamp);\n      }, 60000);\n    };\n  \n    // warning timer\n    let warningInactive = (timeString) => {\n      clearTimeout(startTimerInterval.current);\n  \n      warningInactiveInterval.current = setInterval(() => {\n        const maxTime = 2;\n        const popTime = 1;\n  \n        const diff = moment.duration(moment().diff(moment(timeString)));\n        const minPast = diff.minutes();\n        const leftSecond = 60 - diff.seconds();\n  \n        if (minPast === popTime) {\n          setSecond(leftSecond);\n          setOpen(true);\n        }\n  \n        if (minPast === maxTime) {\n          clearInterval(warningInactiveInterval.current);\n          setOpen(false);\n          sessionStorage.removeItem('lastTimeStamp');\n          logout();\n        }\n      }, 1000);\n    };\n  \n    // reset interval timer\n    let resetTimer = useCallback(() => {\n      clearTimeout(startTimerInterval.current);\n      clearInterval(warningInactiveInterval.current);\n  \n      if (isAuthenticated) {\n        timeStamp = moment();\n        sessionStorage.setItem('lastTimeStamp', timeStamp);\n      } else {\n        clearInterval(warningInactiveInterval.current);\n        sessionStorage.removeItem('lastTimeStamp');\n      }\n      timeChecker();\n      setOpen(false);\n    }, [isAuthenticated]);\n  \n    // handle close popup\n    const handleClose = () => {\n      setOpen(false);\n  \n      resetTimer();\n    };\n  \n    useEffect(() => {\n      events.forEach((event) => {\n        window.addEventListener(event, resetTimer);\n      });\n  \n      timeChecker();\n  \n      return () => {\n        clearTimeout(startTimerInterval.current);\n        //   resetTimer();\n      };\n    }, [resetTimer, events, timeChecker]);\n  \n    console.log(second);\n  \n    if (!isOpen) {\n      return null;\n    }\n  \n    // change fragment to modal and handleclose func to close\n    return <Fragment />;\n  };\n  \n  export default SessionTimeout;"],"mappings":"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"},"metadata":{},"sourceType":"module"}