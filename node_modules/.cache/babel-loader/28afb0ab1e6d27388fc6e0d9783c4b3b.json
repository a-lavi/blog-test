{"ast":null,"code":"import _slicedToArray from\"/Users/alirahmani/Project/blog_project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import moment from'moment';import{IdleTimeOutModal}from'./LogoutModal';import useAuth from\"../hooks/useAuth\";import useLogout from'../hooks/useLogout';import{jsx as _jsx}from\"react/jsx-runtime\";var SessionTimeout=function SessionTimeout(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showModal=_useState2[0],setShowModal=_useState2[1];var _useAuth=useAuth(),auth=_useAuth.auth;console.log(auth);var logout=useLogout();var timer=undefined;var events=['click','load','keydown'];var eventHandler=function eventHandler(eventType){console.log(eventType);if(auth.isAuthenticated){localStorage.setItem('lastInteractionTime',moment());console.log('newtime');if(timer){startTimer();}}};useEffect(function(){addEvents();return function(){removeEvents();clearTimeout(timer);};},[]);var startTimer=function startTimer(){if(timer){clearTimeout(timer);}timer=setTimeout(function(){var lastInteractionTime=localStorage.getItem('lastInteractionTime');var diff=moment.duration(moment().diff(moment(lastInteractionTime)));var timeOutInterval=props.timeOutInterval?props.timeOutInterval:6000;if(!auth.isAuthenticated){clearTimeout(timer);}else{if(diff._milliseconds<timeOutInterval){startTimer();}else{setShowModal(true);}}},props.timeOutInterval?props.timeOutInterval:6000);};var addEvents=function addEvents(){events.forEach(function(eventName){window.addEventListener(eventName,eventHandler);});startTimer();};var removeEvents=function removeEvents(){events.forEach(function(eventName){window.removeEventListener(eventName,eventHandler);});};var handleContinueSession=function handleContinueSession(){setShowModal(false);};var handleLogout=function handleLogout(){removeEvents();clearTimeout(timer);logout();setShowModal(false);};return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(IdleTimeOutModal,{showModal:showModal,handleContinue:handleContinueSession,handleLogout:handleLogout})});};export default SessionTimeout;","map":{"version":3,"names":["React","useEffect","useState","moment","IdleTimeOutModal","useAuth","useLogout","SessionTimeout","props","showModal","setShowModal","auth","console","log","logout","timer","undefined","events","eventHandler","eventType","isAuthenticated","localStorage","setItem","startTimer","addEvents","removeEvents","clearTimeout","setTimeout","lastInteractionTime","getItem","diff","duration","timeOutInterval","_milliseconds","forEach","eventName","window","addEventListener","removeEventListener","handleContinueSession","handleLogout"],"sources":["/Users/alirahmani/Project/blog_project/src/Components/SessionTimeout.js"],"sourcesContent":["import React, { useEffect, useState} from 'react';\nimport moment from 'moment'\nimport { IdleTimeOutModal } from './LogoutModal'\nimport useAuth from \"../hooks/useAuth\";\nimport useLogout from '../hooks/useLogout';\nconst SessionTimeout = (props)=>{\n    const[showModal,setShowModal]=useState(false)\n    const {auth} = useAuth()\n    console.log(auth)\n    const logout = useLogout();\n    let timer=undefined;\n    const events= ['click','load','keydown']\n    const eventHandler =(eventType)=>{\n        \n        console.log(eventType)\n        if(auth.isAuthenticated){\n            localStorage.setItem('lastInteractionTime',moment() )\n            console.log('newtime')\n            if(timer){\n              \n              startTimer();\n          }\n            \n        }\n        \n    };\n    \n    useEffect(()=>{\n        addEvents();\n        \n        return (()=>{\n            \n            removeEvents();\n            clearTimeout(timer);\n        })\n    },[])\n    \n    const startTimer=()=>{\n        \n        if(timer){\n            clearTimeout(timer)\n        }\n        timer=setTimeout(()=>{\n            \n            let lastInteractionTime=localStorage.getItem('lastInteractionTime')\n            \n            const diff = moment.duration(moment().diff(moment(lastInteractionTime)));\n            let timeOutInterval=props.timeOutInterval?props.timeOutInterval:6000;\n            if(!auth.isAuthenticated){\n                clearTimeout(timer)\n            }else{\n                if(diff._milliseconds<timeOutInterval){\n                    startTimer();\n                    \n                }else{\n                    \n                    setShowModal(true)\n                }\n            }\n            \n        },props.timeOutInterval?props.timeOutInterval:6000)\n        \n        \n        \n        \n        \n    }\n    const addEvents=()=>{\n        \n        events.forEach(eventName=>{\n            window.addEventListener(eventName,eventHandler)\n        })\n        \n        startTimer();\n    }\n    \n    const removeEvents=()=>{\n        events.forEach(eventName=>{\n            window.removeEventListener(eventName,eventHandler)\n        })\n    };\n    \n    const handleContinueSession = ()=>{\n        setShowModal(false)\n        \n    }\n    const handleLogout = ()=>{\n        removeEvents();\n        clearTimeout(timer);\n        logout()\n      \n        setShowModal(false)\n        \n    }\n    \n    return(\n        <div>\n        \n        <IdleTimeOutModal \n        showModal={showModal} \n        handleContinue={handleContinueSession}\n        handleLogout={handleLogout}\n        />\n        \n        </div>\n        )\n        \n    }\n  \n  export default SessionTimeout;"],"mappings":"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"},"metadata":{},"sourceType":"module"}