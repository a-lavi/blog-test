{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alirahmani/Project/blog_project/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/alirahmani/Project/blog_project/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/alirahmani/Project/blog_project/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/alirahmani/Project/blog_project/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* import { SettingsSuggestRounded } from \"@mui/icons-material\"; */import{useRef,useState,useEffect}from\"react\";import useAuth from\"../hooks/useAuth\";import{Link,useNavigate,useLocation}from\"react-router-dom\";import axios from\"../Controllers/axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LOGIN_URL=\"/api/login\";var Login=function Login(){var _location$state,_location$state$from;var _useAuth=useAuth(),setAuth=_useAuth.setAuth,persist=_useAuth.persist,setPersist=_useAuth.setPersist;var navigate=useNavigate();var location=useLocation();var from=((_location$state=location.state)===null||_location$state===void 0?void 0:(_location$state$from=_location$state.from)===null||_location$state$from===void 0?void 0:_location$state$from.pathname)||\"/blog_project\";var userRef=useRef();var errRef=useRef();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUser=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPwd=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),errMsg=_useState6[0],setErrMsg=_useState6[1];useEffect(function(){userRef.current.focus();},[]);useEffect(function(){setErrMsg(\"\");},[username,password]);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var _response$data,_response$data2,_response$data3,response,accessToken,roles,expiresIn,expirationTime,_err$response,_err$response2;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return axios.post(LOGIN_URL,JSON.stringify({username:username,password:password}),{headers:{\"Content-Type\":\"application/json\"},withCredentials:true});case 4:response=_context.sent;console.log(JSON.stringify(response===null||response===void 0?void 0:response.data));//console.log(JSON.stringify(response));\naccessToken=response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.accessToken;roles=response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.roles;expiresIn=response===null||response===void 0?void 0:(_response$data3=response.data)===null||_response$data3===void 0?void 0:_response$data3.expiresIn;expirationTime=new Date(new Date().getTime()+ +expiresIn*100);console.log(expirationTime.toISOString());/* setAuth({ username, password, roles, accessToken }); */setAuth(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{username:username,password:password,roles:roles,accessToken:accessToken,expirationTime:expirationTime,isAuthenticated:true});});setUser(\"\");setPwd(\"\");navigate(from,{replace:true});_context.next=22;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](1);console.log(_context.t0);if(!(_context.t0!==null&&_context.t0!==void 0&&_context.t0.response)){setErrMsg(\"No Server Response\");}else if(((_err$response=_context.t0.response)===null||_err$response===void 0?void 0:_err$response.status)===400){setErrMsg(\"Missing Username or Password\");}else if(((_err$response2=_context.t0.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setErrMsg(\"Unauthorized\");}else{setErrMsg(\"Login Failed\");}errRef.current.focus();case 22:case\"end\":return _context.stop();}}},_callee,null,[[1,17]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();var togglePersist=function togglePersist(){setPersist(function(prev){return!prev;});};console.log(persist);useEffect(function(){localStorage.setItem(\"persist\",JSON.stringify(persist));},[persist]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Login\"}),/*#__PURE__*/_jsx(\"p\",{ref:errRef,className:errMsg?\"errmsg\":\"offscreen\",\"aria-live\":\"assertive\",children:errMsg}),/*#__PURE__*/_jsxs(\"form\",{action:\"submit\",id:\"reg-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"input\",{ref:userRef,type:\"text\",placeholder:\"Username\",autoComplete:\"off\",id:\"username\",onChange:function onChange(_ref2){var target=_ref2.target;return setUser(target.value);}}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"Password\",autoComplete:\"off\",id:\"password\",onChange:function onChange(_ref3){var target=_ref3.target;return setPwd(target.value);}}),/*#__PURE__*/_jsx(\"button\",{children:\"Submit\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"persistCheck\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"persist\",onChange:togglePersist,checked:persist}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"persist\",children:\"Trust This Device\"})]})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Need an Account?\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"line\",children:/*#__PURE__*/_jsx(Link,{to:\"/register\",children:\"Sign Up\"})})]})]});};export default Login;","map":{"version":3,"names":["useRef","useState","useEffect","useAuth","Link","useNavigate","useLocation","axios","LOGIN_URL","Login","setAuth","persist","setPersist","navigate","location","from","state","pathname","userRef","errRef","username","setUser","password","setPwd","errMsg","setErrMsg","current","focus","handleSubmit","e","preventDefault","post","JSON","stringify","headers","withCredentials","response","console","log","data","accessToken","roles","expiresIn","expirationTime","Date","getTime","toISOString","prevState","isAuthenticated","replace","status","togglePersist","prev","localStorage","setItem","target","value"],"sources":["/Users/alirahmani/Project/blog_project/src/Components/Login.js"],"sourcesContent":["/* import { SettingsSuggestRounded } from \"@mui/icons-material\"; */\nimport { useRef, useState, useEffect } from \"react\";\nimport useAuth from \"../hooks/useAuth\";\nimport { Link, useNavigate, useLocation } from \"react-router-dom\";\n\nimport axios from \"../Controllers/axios\";\nconst LOGIN_URL = \"/api/login\";\n\nconst Login = () => {\n  const { setAuth, persist, setPersist} = useAuth();\n\n  const navigate = useNavigate();\n  const location = useLocation();\n  const from = location.state?.from?.pathname || \"/blog_project\";\n\n  const userRef = useRef();\n  const errRef = useRef();\n\n  const [username, setUser] = useState(\"\");\n  const [password, setPwd] = useState(\"\");\n  const [errMsg, setErrMsg] = useState(\"\");\n\n  useEffect(() => {\n    userRef.current.focus();\n  }, []);\n\n  useEffect(() => {\n    setErrMsg(\"\");\n  }, [username, password]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    try {\n      const response = await axios.post(\n        LOGIN_URL,\n        JSON.stringify({ username, password }),\n        {\n          headers: { \"Content-Type\": \"application/json\" },\n          withCredentials: true,\n        }\n      );\n      console.log(JSON.stringify(response?.data));\n      //console.log(JSON.stringify(response));\n      const accessToken = response?.data?.accessToken;\n      const roles = response?.data?.roles;\n      const expiresIn= response?.data?.expiresIn\n      const expirationTime =  new Date(new Date().getTime()+ +expiresIn * 100)\n      \n      console.log(expirationTime.toISOString());\n      /* setAuth({ username, password, roles, accessToken }); */\n      setAuth((prevState) => ({\n        ...prevState,\n        username, password, roles, accessToken ,expirationTime,\n        isAuthenticated: true,\n      }));\n      setUser(\"\");\n      setPwd(\"\");\n      navigate(from, { replace: true });\n    } catch (err) {\n      console.log(err);\n      if (!err?.response) {\n        setErrMsg(\"No Server Response\");\n      } else if (err.response?.status === 400) {\n        setErrMsg(\"Missing Username or Password\");\n      } else if (err.response?.status === 401) {\n        setErrMsg(\"Unauthorized\");\n      } else {\n        setErrMsg(\"Login Failed\");\n      }\n      errRef.current.focus();\n    }\n  };\n  const togglePersist = () => {\n    setPersist((prev) => !prev);\n  };\n  console.log(persist);\n  useEffect(() => {\n    localStorage.setItem(\"persist\", JSON.stringify(persist));\n  }, [persist]);\n\n  return (\n    <div>\n      <h2>Login</h2>\n      <p\n        ref={errRef}\n        className={errMsg ? \"errmsg\" : \"offscreen\"}\n        aria-live=\"assertive\"\n      >\n        {errMsg}\n      </p>\n      <form action=\"submit\" id=\"reg-form\" onSubmit={handleSubmit}>\n        <input\n          ref={userRef}\n          type=\"text\"\n          placeholder=\"Username\"\n          autoComplete=\"off\"\n          id=\"username\"\n          onChange={({ target }) => setUser(target.value)}\n        />\n        <input\n          type=\"password\"\n          placeholder=\"Password\"\n          autoComplete=\"off\"\n          id=\"password\"\n          onChange={({ target }) => setPwd(target.value)}\n        />\n        <button>Submit</button>\n        <div className=\"persistCheck\">\n          <input\n            type=\"checkbox\"\n            id=\"persist\"\n            onChange={togglePersist}\n            checked={persist}\n          />\n          <label htmlFor=\"persist\">Trust This Device</label>\n        </div>\n      </form>\n      <p>\n        Need an Account?\n        <br />\n        <span className=\"line\">\n          <Link to=\"/register\">Sign Up</Link>\n        </span>\n      </p>\n    </div>\n  );\n};\n\nexport default Login;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}