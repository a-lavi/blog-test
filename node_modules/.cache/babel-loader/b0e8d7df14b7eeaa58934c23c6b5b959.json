{"ast":null,"code":"var _jsxFileName = \"/Users/alirahmani/Project/blog_project/src/Components/SessionTimeout.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport moment from 'moment';\nimport { IdleTimeOutModal } from './IdleTimeOutModal';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SessionTimeout = props => {\n  _s();\n\n  const [showModal, setShowModal] = useState(false);\n  const [isLogout, setLogout] = useState(false);\n  let timer = undefined;\n  const events = ['click', 'load', 'keydown'];\n\n  const eventHandler = eventType => {\n    console.log(eventType);\n\n    if (!isLogout) {\n      localStorage.setItem('lastInteractionTime', moment());\n\n      if (timer) {\n        props.onActive();\n        startTimer();\n      }\n    }\n  };\n\n  useEffect(() => {\n    addEvents();\n    return () => {\n      removeEvents();\n      clearTimeout(timer);\n    };\n  }, []);\n\n  const startTimer = () => {\n    if (timer) {\n      clearTimeout(timer);\n    }\n\n    timer = setTimeout(() => {\n      let lastInteractionTime = localStorage.getItem('lastInteractionTime');\n      const diff = moment.duration(moment().diff(moment(lastInteractionTime)));\n      let timeOutInterval = props.timeOutInterval ? props.timeOutInterval : 6000;\n\n      if (isLogout) {\n        clearTimeout(timer);\n      } else {\n        if (diff._milliseconds < timeOutInterval) {\n          startTimer();\n          props.onActive();\n        } else {\n          props.onIdle();\n          setShowModal(true);\n        }\n      }\n    }, props.timeOutInterval ? props.timeOutInterval : 6000);\n  };\n\n  const addEvents = () => {\n    events.forEach(eventName => {\n      window.addEventListener(eventName, eventHandler);\n    });\n    startTimer();\n  };\n\n  const removeEvents = () => {\n    events.forEach(eventName => {\n      window.removeEventListener(eventName, eventHandler);\n    });\n  };\n\n  const handleContinueSession = () => {\n    setShowModal(false);\n    setLogout(false);\n  };\n\n  const handleLogout = () => {\n    removeEvents();\n    clearTimeout(timer);\n    setLogout(true);\n    props.onLogout();\n    setShowModal(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(IdleTimeOutModal, {\n      showModal: showModal,\n      handleContinue: handleContinueSession,\n      handleLogout: handleLogout\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 9\n  }, this);\n};\n\n_s(SessionTimeout, \"DlN5Ac5N2wIFst1tdLmP04HA4F8=\");\n\n_c = SessionTimeout;\nexport default SessionTimeout;\n\nvar _c;\n\n$RefreshReg$(_c, \"SessionTimeout\");","map":{"version":3,"names":["React","useEffect","useState","moment","IdleTimeOutModal","SessionTimeout","props","showModal","setShowModal","isLogout","setLogout","timer","undefined","events","eventHandler","eventType","console","log","localStorage","setItem","onActive","startTimer","addEvents","removeEvents","clearTimeout","setTimeout","lastInteractionTime","getItem","diff","duration","timeOutInterval","_milliseconds","onIdle","forEach","eventName","window","addEventListener","removeEventListener","handleContinueSession","handleLogout","onLogout"],"sources":["/Users/alirahmani/Project/blog_project/src/Components/SessionTimeout.js"],"sourcesContent":["import React, { useEffect, useState} from 'react';\nimport moment from 'moment'\nimport { IdleTimeOutModal } from './IdleTimeOutModal'\n\nconst SessionTimeout = (props)=>{\n    const[showModal,setShowModal]=useState(false)\n    const[isLogout,setLogout]=useState(false)\n    let timer=undefined;\n    const events= ['click','load','keydown']\n    const eventHandler =(eventType)=>{\n        \n        console.log(eventType)\n        if(!isLogout){\n            localStorage.setItem('lastInteractionTime',moment() )\n            if(timer){\n                props.onActive();\n                startTimer();\n            }\n        }\n        \n    };\n    \n    useEffect(()=>{\n        addEvents();\n        \n        return (()=>{\n            \n            removeEvents();\n            clearTimeout(timer);\n        })\n    },[])\n    \n    const startTimer=()=>{\n        \n        if(timer){\n            clearTimeout(timer)\n        }\n        timer=setTimeout(()=>{\n            \n            let lastInteractionTime=localStorage.getItem('lastInteractionTime')\n            const diff = moment.duration(moment().diff(moment(lastInteractionTime)));\n            let timeOutInterval=props.timeOutInterval?props.timeOutInterval:6000;\n            if(isLogout){\n                clearTimeout(timer)\n            }else{\n                if(diff._milliseconds<timeOutInterval){\n                    startTimer();\n                    props.onActive();\n                }else{\n                    props.onIdle();\n                    setShowModal(true)\n                }\n            }\n            \n        },props.timeOutInterval?props.timeOutInterval:6000)\n        \n        \n        \n        \n        \n    }\n    const addEvents=()=>{\n        \n        events.forEach(eventName=>{\n            window.addEventListener(eventName,eventHandler)\n        })\n        \n        startTimer();\n    }\n    \n    const removeEvents=()=>{\n        events.forEach(eventName=>{\n            window.removeEventListener(eventName,eventHandler)\n        })\n    };\n    \n    const handleContinueSession = ()=>{\n        setShowModal(false)\n        setLogout(false)\n    }\n    const handleLogout = ()=>{\n        removeEvents();\n        clearTimeout(timer);\n        setLogout(true)\n        props.onLogout();\n        setShowModal(false)\n        \n    }\n    \n    return(\n        <div>\n        \n        <IdleTimeOutModal \n        showModal={showModal} \n        handleContinue={handleContinueSession}\n        handleLogout={handleLogout}\n        />\n        \n        </div>\n        )\n        \n    }\n  \n  export default SessionTimeout;"],"mappings":"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"},"metadata":{},"sourceType":"module"}